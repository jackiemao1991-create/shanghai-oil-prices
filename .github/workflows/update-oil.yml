name: Update Shanghai oil price
on:
  schedule:
    - cron: '0 20 * * *'   # 每天 20:00 UTC -> 对应次日 04:00 中国/上海时间 (UTC+8)
  workflow_dispatch: {}    # 允许手动触发（方便测试）

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Run fetch script
        env:
          OIL_API_TOKEN: ${{ secrets.OIL_API_TOKEN }}   # 需要在仓库 secrets 中配置
        run: |
          node --version
          node fetch.js

      - name: Commit & push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add data/shanghai.json
          git commit -m "Update Shanghai oil price" || echo "No changes to commit"
          git push
